<html>
  <head>
    <title>defer_javascript example</title>
  </head>
  <body>
    <script type="application/javascript">
      var output = [];
      var headElem = document.getElementsByTagName("head")[0];
      elt = document.createElement("script");
      elt.setAttribute("type", "text/javascript");
      elt.setAttribute("src", '../assets/js_push1.js');
      elt.onload = function() {
        expect(elt.getAttribute("src")).to.eql("../assets/js_push2.js");
      }
      headElem.appendChild(elt);
      expect(elt.getAttribute("src")).to.eql("../assets/js_push1.js");
      expect(elt.getAttribute("src")).to.eql("../assets/js_push1.js");
      elt.setAttribute("src", "../assets/js_push2.js");
    </script>
    <script type="application/javascript">
      done(function () {
        expect(output).to.eql([1]);
      });
    </script>
  </body>
</html>
